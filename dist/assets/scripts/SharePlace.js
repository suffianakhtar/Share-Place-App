(()=>{"use strict";function e(e){const t=document.getElementById(e),n=document.getElementById("modal-template"),o=document.importNode(n.content,!0),a=o.querySelector(".backdrop"),r=o.querySelector(".modal"),l=document.importNode(t.content,!0);r.append(l),document.body.prepend(a,r)}function t(){const e=document.querySelector(".backdrop"),t=document.querySelector(".modal");e.remove(),t.remove()}const n=document.getElementById("locate-btn"),o=document.getElementById("address-form"),a=document.getElementById("share-btn");function r(e,t){document.getElementById("map").innerHTML="",function(e){"undefined"==typeof ol&&alert("Could not load maps library - please try again later!"),new ol.Map({target:"map",layers:[new ol.layer.Tile({source:new ol.source.OSM})],view:new ol.View({center:ol.proj.fromLonLat([e.lng,e.lat]),zoom:16})})}(e),a.removeAttribute("disabled"),document.getElementById("share-link").value=`${location.origin}/my-place/index.html?address=${encodeURI(t)}&lat=${e.lat}&lng=${e.lng}`}n.addEventListener("click",function(){navigator.geolocation?(e("loading-modal-content"),navigator.geolocation.getCurrentPosition(async e=>{const n={lat:e.coords.latitude,lng:e.coords.longitude};r(n,await async function(e){const t=await fetch(`http://nominatim.openstreetmap.org/reverse?format=json&lon=${e.lng}&lat=${e.lat}`);if(!t.ok)throw new Error("Failed to fetch address. Please try again!");return(await t.json()).display_name}(n)),t()},e=>{t(),alert("Failed to fetch location. Reason: "+e.message+" Please enter address manually!")})):alert("Location feature is not available in browser - please use a modern browser or manually enter an address!")}),o.addEventListener("submit",async function(n){n.preventDefault();const o=n.target.querySelector("input").value;if(o&&""!==o.trim()){e("loading-modal-content");try{const e=await async function(e){const t=encodeURI(e),n=await fetch(`http://nominatim.openstreetmap.org/search?format=json&q=${t}`);if(!n.ok)throw new Error("Failed to fetch coordinates. Please try again!");const o=await n.json();if(0===o.length)throw new Error("Place not found. Please enter a valid address!");return{lat:o[0].lat,lng:o[0].lon}}(o);r(e,o)}catch(e){alert(e.message)}t()}else alert("Invalid address entered - please try again!")}),a.addEventListener("click",function(){const e=document.getElementById("share-link");location.assign(e.value)})})();